<?php$id = $_GET['id'];if( isset( $_POST ) && !empty( $_POST ) ){	$application = Application::findById($id);	$application->student_id = (int)$_POST['student_id'];	$application->school_id = (int)$_POST['school'];	$application->subject_id = (int)$_POST['subject'];	$application->status = (int)$_POST['status'];		if( $application->update() ){		$_SESSION['success'] = 'Application submitted!';		header('Location: index.php?module=admin');		exit;	}else{		$_SESSION['error'] = 'Application failed!';	}}
ob_start();	$app = Application::findById($id);	$student = Student::findById( $app->student_id );		$schools = School::all();	$subjects = Subject::ofSchool( $app->school_id );	$statuses = Application::statuses();?><div>
	<div>		<h1>Update Applications <span class="text-muted">#<?php echo $id; ?></span></h1>
		<hr />	</div>		<form action="" class="form-horizontal" method="post" id="application-form">		<input type="hidden" name="student_id" value="<?php echo $student->id; ?>" />		<h3>Student Record</h3>		<hr />		<div class="form-group">			<div class="col-md-3 col-sm-3 col-xs-12">				<label for="matric_no">Matric No.</label>			</div>			<div class="col-md-9 col-sm-9 col-xs-12">				<input type="text" class="form-control" value="<?php echo $student->matric_no; ?>" name="matric_no" readonly="readonly" />			</div>		</div>				<div class="form-group">			<div class="col-md-3 col-sm-3 col-xs-12">				<label for="full_name">Full Name</label>			</div>			<div class="col-md-9 col-sm-9 col-xs-12">				<input type="text" class="form-control" value="<?php echo $student->full_name; ?>" name="full_name" readonly="readonly" />			</div>		</div>				<div class="form-group">			<div class="col-md-3 col-sm-3 col-xs-12">				<label for="programme">Programme</label>			</div>			<div class="col-md-9 col-sm-9 col-xs-12">				<input type="text" class="form-control" value="<?php echo $student->programme_name; ?>" name="programme" readonly="readonly" />			</div>		</div>				<?php /* ?><div class="form-group">			<div class="col-md-3 col-sm-3 col-xs-12">				<label for="faculty">Faculty</label>			</div>			<div class="col-md-9 col-sm-9 col-xs-12">				<input type="text" class="form-control" value="<?php echo $student->faculty_name; ?>" name="faculty" readonly="readonly" />			</div>		</div><?php */ ?>				<h3>School Record</h3>		<hr />				<div class="form-group">			<div class="col-md-3 col-sm-3 col-xs-12">				<label for="school">School</label>			</div>			<div class="col-md-9 col-sm-9 col-xs-12">				<select name="school" id="school" class="form-control">					<option value="">-- select --</option>				<?php				foreach( $schools as $school ){					if( $school['id'] == $app->school_id ){						echo "<option value=\"$school[id]\" selected=\"selected\">$school[name]</option>";					}else{						echo "<option value=\"$school[id]\">$school[name]</option>";					}				}				?>				</select>			</div>		</div>				<div class="form-group">			<div class="col-md-3 col-sm-3 col-xs-12">				<label for="subject">Subject</label>			</div>			<div class="col-md-9 col-sm-9 col-xs-12">				<select name="subject" id="subject" class="form-control">					<?php					if( !empty( $subjects ) ){						foreach( $subjects as $subject ){							if( $subject['id'] == $app->subject_id ){								echo "<option value=\"$subject[id]\" selected=\"selected\">$subject[name]</option>";							}else{								echo "<option value=\"$subject[id]\">$subject[name]</option>";							}						}					}					?>				</select>			</div>		</div>				<div class="form-group">			<div class="col-md-3 col-sm-3 col-xs-12">				<label for="status">Status</label>			</div>			<div class="col-md-9 col-sm-9 col-xs-12">				<select name="status" id="status" class="form-control">					<option value="">-- select --</option>				<?php				foreach( $statuses as $status ){					if( $status['id'] == $app->status ){						echo "<option value=\"$status[id]\" selected=\"selected\">$status[name]</option>";					}else{						echo "<option value=\"$status[id]\">$status[name]</option>";					}				}				?>				</select>			</div>		</div>				<button type="submit" class="btn btn-primary btn-md">			<i class="fa fa-angle-double-right"></i> Submit		</button>			</form></div><?php$content = ob_get_clean();View::addContent( $content );View::addStylesheet('<link rel="stylesheet" href="/assets/plugins/bootstrap-toastr/toastr.min.css" />');View::addJavascript('<script type="text/javascript" src="/assets/plugins/bootstrap-toastr/toastr.min.js"></script>');$js = <<<JS	<script type="text/javascript">	jQuery(function($){		$('#application-form').submit(function(){			var errors = [];						if( $('#school').val() == '' ){				errors.push('Please select a school!');			}						if( $('#subject').val() == '' ){				errors.push('Please select a subject!');			}						if( errors.length > 0 ){				$.each(errors, function(i,e){					toastr.error(e, 'Notification');				});				return false;			}		});				$('#school').change(function(){			var t = $(this).val();			$.getJSON('index.php?module=subject&action=load&school='+t, function(resp){				$('#subject').empty();				$.each(resp, function(i,e){					$('#subject').append('<option value="'+e.id+'">'+e.name+'</option>');				});			});		});JS;if( !empty( $_SESSION['error'] ) ){	$js .= <<<JS		toastr.error( '$_SESSION[error]', 'Error Notification' );JS;	unset( $_SESSION['error'] );}$js .= <<<JS	});	</script>JS;View::addJavascript($js);
?>